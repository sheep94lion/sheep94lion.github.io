<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv = "Content-Type" content = "text/html; charset=UTF-8">
		<link rel = "stylesheet" type = "text/css" href = "style.css" />
		<script src = "jquery-1.11.3.min.js"></script>
		<script>
			var xmlhttp;
			var flag = 1;
			var index = 1;
			function addonepic(picname){//这个函数的作用是将图片picname插入到最短的一列
				var minid = '#1-col';//找到最短的一列
				if ($('#2-col').height() < $(minid).height()){
					minid = '#2-col';
				}
				if ($('#3-col').height() < $(minid).height()){
					minid = '#3-col';
				}
				if ($('#4-col').height() < $(minid).height()){
					minid = '#4-col';
				}
				var html1 = '<div class = "waterfall-item"><img src = "';
				var html2 = '" class = "waterfall-picitem"></div>';
				var html = html1 + picname + html2;
				$(minid).append(html);
			}
			addPrimaryPics = function(){
				for (var i = 1; i <= 25; i++){
					var picname = i + '.jpg';
					addonepic(picname);
				}
			};
			window.onload = addPrimaryPics;//加载一开始的25张图片
			$(document).scroll(function(event){//检查是不是快到页面底部了
				if(flag == 0){return;}
				flag = 0;//在此次要加载的图片加载完成之前不再响应scroll事件。
				if (($(document).height() - document.body.scrollTop) < 1600){
					xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
						if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
							var picarray = eval(xmlhttp.responseText);
							for(var i = 0; i < picarray.length; i++){
								addonepic(picarray[i]);
							}
							flag = 1;
						}
					}
					var s = index.toString() + '.json';
					xmlhttp.open("GET", s, true);
					xmlhttp.send();
					index++;
					if(index == 4){flag = 0;}
				}
				else{
					flag = 1;
				}
			});
		</script>
		<title>Love Love Love</title>
	</head>
	<body>
		<audio controls autoplay loop preload class = "audio">
			<source src = "bg.mp3" type = "audio/mpeg">
		</audio>

		<div id = "whole-waterfall">
			<div class = "waterfall-col" id = "1-col">
				
			</div>
			<div class = "waterfall-col" id = "2-col">
				
			</div>
			<div class = "waterfall-col" id = "3-col">
				
			</div>
			<div class = "waterfall-col" id = "4-col">
				
			</div>
		</div>
		<script>

		</script>
	</body>
</html>
