<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv = "Content-Type" content = "text/html; charset=UTF-8">
		<link rel = "stylesheet" type = "text/css" href = "style.css" />
		<script src = "jquery-1.11.3.min.js"></script>
		<script>
			var xmlhttp;
			var flag = 1;
			var index = 1;
			function clickpic(){
				$('.shelter').css('visibility', 'visible');
				$('#bigpic').attr('src', this.src);
				$('#bigpic').css('visibility', 'visible')
				$('#bigpic_pic_img').attr('src', this.src)
				$('#bigpic').css('left', (($(window).width()- $('#bigpic').width()) / 2).toString() + 'px');
				$('#bigpic').css('top', (($(window).height() - $('#bigpic').height()) / 2).toString() + 'px');
				$('#bigpic').css('height', $('#bigpic_pic_img').css('height'));


			}
			function addonepic(picname){//这个函数的作用是将图片picname插入到最短的一列
				var minid = '#col1';//找到最短的一列
				if ($('#col2').height() < $(minid).height()){
					minid = '#col2';
				}
				if ($('#col3').height() < $(minid).height()){
					minid = '#col3';
				}
				if ($('#col4').height() < $(minid).height()){
					minid = '#col4';
				}
				var image = document.createElement("img");
				$(image).attr('src', picname).attr('class', "waterfall-picitem").click(clickpic);
				var div = document.createElement("div");
				$(div).attr('class', 'waterfall-item').append(image);
				//var html1 = '<div class = "waterfall-item"><img src = "';
				//var html2 = '" class = "waterfall-picitem"></div>';
				//var html = html1 + picname + html2;
				$(minid).append(div);
			}
			addPrimaryPics = function(){
				$('.waterfall-picitem').click(function(){alert();});
				setInterval(function(){
					$('.shelter').css('height', $('body').css('height'));
				}, 500);
				for (var i = 1; i <= 25; i++){
					var picname = i + '.jpg';
					addonepic(picname);
				}
			};
			window.onload = addPrimaryPics;//加载一开始的25张图片
			$(document).scroll(function(event){//检查是不是快到页面底部了
				if(flag == 0){return;}
				flag = 0;//在此次要加载的图片加载完成之前不再响应scroll事件。
				if (($(document).height() - document.body.scrollTop) < 1600){
					xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function(){
						if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
							var picarray = eval(xmlhttp.responseText);
							for(var i = 0; i < picarray.length; i++){
								addonepic(picarray[i]);
							}
							flag = 1;
						}
					}
					var s = index.toString() + '.json';
					xmlhttp.open("GET", s, true);
					xmlhttp.send();
					index++;
					if(index == 4){flag = 0;}
				}
				else{
					flag = 1;
				}
			});
		</script>
		<title>Love Love Love</title>
	</head>
	<body>
		<audio controls autoplay loop preload class = "audio">
			<source src = "bg.mp3" type = "audio/mpeg">
		</audio>
		<div class = "shelter">
			
		</div>
		<div id = "bigpic">
			<div id = "bigpic_pic_div">
				<img id = "bigpic_pic_img">
			</div>
			<div id = "bigpic_comment">
				</div>
			</div>
		<div id = "whole-waterfall">
			<div class = "waterfall-col" id = "col1">
				
			</div>
			<div class = "waterfall-col" id = "col2">
				
			</div>
			<div class = "waterfall-col" id = "col3">
				
			</div>
			<div class = "waterfall-col" id = "col4">
				
			</div>
		</div>
		<script>

		</script>
	</body>
</html>
